<canvas id = "canvas" width = "1000" height = "1000"></canvas>

<script src = "/piece.js"></script>
<script src = "/clickedEffect.js"></script>
<script>
    //var selected = false;
    var posX, posY;
    var pieceSelected;
    const canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var size = 40;
    var x = 40;
    var y = 40;
    var board = [];

    var knightImg = document.createElement('img');
    knightImg.src = 'knight.png';

    for(var i = 0; i< 16 ; i++) {
        board[i] = [];
        for(var j = 0; j<16;j++){
            board[i][j] = new Piece(i,j,-1);
        }
    }
    knightImg.onload = function() {
        board[4][4].drawImg(knightImg);
    }
    function move(event){
        var tempX = Math.floor(event.layerX/size)-1;
        var tempY = Math.floor(event.layerY/size)-1;
        var tempPiece = board[tempX][tempY];
        if(board[tempX][tempY].hasPiece){
            pieceSelected = board[tempX][tempY];
            board[tempX][tempY].selected = true;
            clickedEffect(pieceSelected.posX,pieceSelected.posY,ctx,size);
            ctx.drawImage(knightImg, pieceSelected.posX, pieceSelected.posY, size, size);
        }else{
            if(pieceSelected.selected){
                if(!((tempY < 4 || tempY > 11) && (tempX<4 ||tempX>11))) {
                    if (((Math.abs(tempX - pieceSelected.x) == 1) && Math.abs(tempY - pieceSelected.y) == 2)
                            || ((Math.abs(tempX - pieceSelected.x) == 2) && Math.abs(tempY - pieceSelected.y) == 1)) {
                        ctx.beginPath();
                        ctx.rect(pieceSelected.posX, pieceSelected.posY, size, size);

                        if ((tempX + tempY) % 2 == 0) {
                            ctx.fillStyle = "#F5F5DC";
                        } else {
                            ctx.fillStyle = "#A9A9A9";
                        }
                        ctx.fill();
                        ctx.drawImage(knightImg, tempPiece.posX, tempPiece.posY, size, size);
                        board[tempX][tempY].hasPiece = true;
                        board[tempX][tempY].selected = false;
                        pieceSelected.hasPiece = false;
                        pieceSelected.selected = false;

                    }
                }
            }
        }
    }

    for(var i = 0; i < 16 ; i++){
        posY = y + size * i;
        for (var j = 0; j < 16 ; j++){
            posX = x + size * j;
            if(!((j < 4 || j > 11) && (i<4 ||i>11))) {
                ctx.beginPath();
                ctx.rect(posX, posY, size, size);
                if ((i + j) % 2 != 0) {
                    ctx.fillStyle = "#F5F5DC";
                } else {
                    ctx.fillStyle = "#A9A9A9";
                }
                ctx.fill();
            }
        }
        posX = 80;
    }
    canvas.onclick = move;
</script>